---
title: iview树组件源码阅读笔记
tags: vue iview
categories: vue
---

好久没有记一些东西了，本菜鸡又来水文章了。

# 写在前面

* iview里面的树组件思路跟vue官网上的[树形视图][]示例类似，应用了组件的递归使用（好像是废话

* 整个树组件里有两个vue文件，一个是递归使用的node.vue，一个是父组件tree.vue

* 组件内的事件大致分为三种：expand（展开）、select（点击节点title触发）和check（复选框的选中与取消触发）

# node.vue

这个组件内包括树组件的一个选项，以及它的children（如果有）

首先来看看**template部分**

```vue
<template>
    <collapse-transition>
        <ul :class="classes" v-show="visible">
            <li>
                <span :class="arrowClasses" @click="handleExpand">
                    <Icon type="arrow-right-b"></Icon>
                </span>
                <Checkbox
                        v-if="showCheckbox"
                        :value="data.checked"
                        :indeterminate="indeterminate"
                        :disabled="data.disabled || data.disableCheckbox"
                        @click.native.prevent="handleCheck"></Checkbox>
                <span :class="titleClasses" v-html="data.title" @click="handleSelect"></span>
                <Tree-node
                        v-for="item in data.children"
                        :key="item.nodeKey"
                        :data="item"
                        :visible="data.expand"
                        :multiple="multiple"
                        :show-checkbox="showCheckbox">
                </Tree-node>
            </li>
        </ul>
    </collapse-transition>
</template>
```

`collapse-transition`应该是父节点展开收起的动画效果，`ul`则是包括一个父节点，里面的`tree-node`是这个父节点的所有子节点，通过`v-for`循环渲染出来，而其子节点的每一项跟父节点是一样的结构，所以`tree-node`实际上就是`node.vue`组件本身。

然后是**script部分**

## 主要props

```javascript
props: {
    data: {
        type: Object,
        default () {
            return {};
        }
    },
    multiple: {
        type: Boolean,
        default: false
    },
    showCheckbox: {
        type: Boolean,
        default: false
    },
    visible: {
        type: Boolean,
        default: false
    }
},
```

* data: 树的数据，根据template中的`v-for="item in data.children"`和`:data="item"`可以知道每个节点的data都是当前节点的信息包括所有的子节点，简化的数据结构如下

```javascript
{
  title: '父节点',
  children: [{
    title: '子节点1',
  }, {
    title: '子节点2',
    children: [{
      title: '子节点2的子节点',
    }]
  }],
}
```

在`methods`中，又对data追加声明了4个额外的属性：selected、disabled、expand、checked，具体是干嘛的看名字应该很清楚了

* multiple: 控制多选的布尔值，默认false，这是控制能否select多个节点的值，而不是控制能不能check多个复选框的值

* 其他props，showCheckbox、visible字面意思都能看出来，不多说

## data

```javascript
data () {
    return {
        prefixCls: prefixCls,
        indeterminate: false
    };
},
```

* prefixCls：控制class前缀的，主要用于样式

* indeterminate：对应checkbox的indeterminate状态

## computed

computed中返回的都是跟class相关的值，应用样式的，就不说了。

## created & mounted

```javascript
created () {
    // created node.vue first, mounted tree.vue second
    if (!this.data.checked) this.$set(this.data, 'checked', false);
},
mounted () {
    this.$on('indeterminate', () => {
        this.broadcast('TreeNode', 'indeterminate');
        this.setIndeterminate();
    });
}
```

在created阶段定义了data props的checked属性<br>
在mounted阶段监听了indeterminate事件，并广播该事件到所有的子节点中

## methods








[树形视图]: https://cn.vuejs.org/v2/examples/tree-view.html